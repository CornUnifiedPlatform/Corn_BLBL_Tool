@page "/UnfollowBatchedTaskConfig"
@using Microsoft.AspNetCore.Authorization
@attribute [Authorize]
@rendermode InteractiveServer

<PageTitle>批量取关任务配置</PageTitle>

<MudContainer>
    <MudText Typo="Typo.h4" Class="mb-4">批量取关任务配置</MudText>

    @if (_isLoading)
    {
        <MudProgressCircular Color="Color.Primary" Indeterminate="true" />
    }
    else
    {
        <EditForm Model="@_config" OnValidSubmit="HandleValidSubmitAsync">
            <DataAnnotationsValidator />
            <MudCard>
                <MudCardContent>
                    <MudGrid>
                        <MudItem xs="12" md="6">
                            <MudTextField T="string" @bind-Value="_config.GroupName" Label="取关的分组名称"
                                HelperText="默认为'天选时刻'" />

                            <MudNumericField T="int" @bind-Value="_config.Count" Label="本次取关个数"
                                Min="0" HelperText="倒序，从后往前取关" Class="mt-3" />
                        </MudItem>

                        <MudItem xs="12" md="6">
                            <MudTextField T="string" @bind-Value="_config.RetainUids" Label="白名单（保留的UpId）"
                                HelperText="多个用英文逗号分隔，配置后，批量取关时不会取关配置的Up" />

                            <MudTextField T="string" @bind-Value="_config.Cron" Label="定时任务Cron表达式" Class="mt-3"
                                HelperText="例如：0 0 6 1 * ? (每月1号早上6点执行)" />
                        </MudItem>
                    </MudGrid>
                </MudCardContent>
                <MudCardActions>
                    <MudButton ButtonType="ButtonType.Submit" Variant="Variant.Filled" Color="Color.Primary">保存配置</MudButton>
                    <MudButton Variant="Variant.Outlined" Color="Color.Secondary" OnClick="LoadConfigAsync" Class="ml-2">重新加载</MudButton>
                </MudCardActions>
            </MudCard>
        </EditForm>

        @if (!string.IsNullOrEmpty(_saveMessage))
        {
            <MudAlert Severity="@(_saveSuccess ? Severity.Success : Severity.Error)" Class="mt-3">
                @_saveMessage
            </MudAlert>
        }
    }
</MudContainer>

<MudThemeProvider/>
<MudPopoverProvider/>
<MudDialogProvider/>
<MudSnackbarProvider/>
